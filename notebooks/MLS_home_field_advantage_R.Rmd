---
title: "MLS Home Field Advantage R"
author: "Breezy Hofmeister"
date: "2025-12-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction:

The goal of this project is very simple. Can I breakdown a large data set on Major League Soccer(MLS) into actionable insights? In this scenario I am going to see if there is a significant home field advantage in MLS. I will be using basic statistical methods to complete this, and I hope you find it insightful!

Data sourced from:https://www.kaggle.com/datasets/josephvm/major-league-soccer-dataset

## Preparing the Data:

```{r data prep}
#First we are going to have to load in the necessary packages
library(tidyverse)
library(ggplot2)
library(scales)
```

```{r data prep 2}
#2025 MLS match data from 1996-2020
url <- "https://raw.githubusercontent.com/bhofmeister0304/team-performance-analysis/refs/heads/main/data/raw/matches.csv"

df_matches <- read_csv(url)

head(df_matches)

# Data sourced from: https://www.kaggle.com/datasets/josephvm/major-league-soccer-dataset
```
```{r data filtering}
#Narrowing down my analysis period
#I want to look at the data from 2015 to 2019 (pre-covid)
df_matches <- df_matches |>
  filter(df_matches$year <= 2019 & df_matches$year >= 2015)

#Selecting the columns for my analysis
columns_to_keep <- c('id', 'home', 'away', 'date', 'year', 'attendance', 'home_score', 'away_score',
                   'home_possessionPct', 'away_possessionPct', 'home_shotsSummary', 'away_shotsSummary',
                   'home_foulsCommitted', 'away_foulsCommitted', 'home_yellowCards', 'away_yellowCards',
                   'home_redCards', 'away_redCards', 'home_offsides', 'away_offsides', 'home_wonCorners',
                   'away_wonCorners', 'home_saves', 'away_saves')

df_matches_filtered <- df_matches[, columns_to_keep]

head(df_matches_filtered)

```
```{r feature engineering}
#Creating new columns for analysis

#First, a simple results function
get_result <- function(row) {
  if (row[['home_score']] > row[['away_score']]) {
    return('home_win')
  } else if (row[['home_score']] < row[['away_score']]) {
    return('away_win')
  } else {
    return('draw')
  }
}
#Applying the function to the filtered dataframe
df_matches_filtered$result <- apply(df_matches_filtered, 1, get_result)
head(df_matches_filtered)

```

## Data Exploration:

```{r home_away table}
#Seeing the performance of teams at home versus away
home_away_table <- df_matches_filtered |>
  group_by(result) |>
  summarise(result_count = n())

#adding percentages to this result
home_away_pct <- df_matches_filtered |>
  group_by(result) |>
  summarise(percentage = n()/nrow(df_matches_filtered) * 100)

#Combining into a table
home_away_summary <- data.frame(
  Result = home_away_table$result,
  Count = home_away_table$result_count,
  Percentage = round(home_away_pct$percentage, 2)
)

home_away_summary

# As can be seen from this very simple analysis, home teams appear to have a stark advantage over away teams
```
```{r year_breakdown}
# Now let us break that down by each year
year_table <- df_matches_filtered |>
  group_by(year, result) |>
  summarise(result_count = n())

# Now adding the percentages
year_pcts <- df_matches_filtered |>
  group_by(year, result) |>
  summarise(count = n(), .groups = 'drop') |>
  group_by(year) |>
  mutate(percentage = count / sum(count) * 100)

year_pcts

#Combining the results into a table
year_summary <- data.frame(
    Year = year_table$year,
    Result = year_table$result,
    Count = year_table$result_count,
    Percentage = round(year_pcts$percentage,2)
)
year_summary
```

```{r preparing_to_plot}
# #That is pretty consistent, but lets see if we can make that into a nicer visual
year_summary2 <- df_matches_filtered |>
  group_by(year, result) |>
  summarise(Count = n(), .groups = 'drop')

# Pivot wider for plotting
plot_df <- year_summary2 |>
  pivot_wider(names_from = result, values_from = Count, values_fill = 0)
```
```{r plot_one}
match_results_visual <- ggplot(data = year_summary2, aes(x = factor(year), y = Count, fill = result)) +
  geom_bar(stat = "identity", position = "stack") + 
  scale_fill_manual(
    values = c("home_win" = "steelblue","draw" = "lightgray","away_win" = "darkolivegreen"),
    labels = c("home_win" = "Home Win", "draw" = "Draw", "away_win" = "Away Win")) +
  ylab("Number of Matches") +
  xlab("Year") +
  labs(fill = "Result") +
  ggtitle("MLS Match Results by Year (Counts)") +
  theme_classic()

print(match_results_visual)


```

#### Visualization Results:

* It appears that results stay pretty consistent each season with the home team maintaining an advantage
* However, there is an increase in matches played each year, so visualizing the percentages should be more helpful

```{r plot_two}
#Creating a visualization for the percentage of match results each year
plot_pct <- year_summary %>%
  select(Year, Result, Percentage) %>%
  pivot_wider(
    names_from = Result,
    values_from = Percentage)
# Plot
ggplot(plot_pct, aes(x = Year)) +
  geom_line(aes(y = home_win, color = "Home Win"), size = 1) +
  geom_point(aes(y = home_win, color = "Home Win"), size = 2) +
  geom_line(aes(y = draw, color = "Draw"), size = 1) +
  geom_point(aes(y = draw, color = "Draw"), size = 2) +
  geom_line(aes(y = away_win, color = "Away Win"), size = 1) +
  geom_point(aes(y = away_win, color = "Away Win"), size = 2) +
  scale_color_manual(
    values = c("Home Win" = "green4", "Draw" = "orange", "Away Win" = "dodgerblue")) +
  scale_y_continuous(labels = percent_format(scale = 1), limits = c(0, 100)) +
  labs(
    title = "Percentage of Match Results by Year",
    x = "Year",
    y = "Percentage of Matches",
    color = "Result") +
  theme_minimal()


```

### Discussion:

As expected, the results stay relatively consistent from year to year. Home teams have an obvious home field advantage. Maybe there are some other questions we can explore. Which teams had the largest home field advantage? Well, that would likely just be the best teams! Lets see instead what teams had the biggest difference in performance home versus away. If we compare that maybe we can even find the affect of playing at home for each season!

## Simple Linear Regression:
```{r home}
#The next step that I think I want to take is doing a simple linear regression to see the impact of playing at home on points awarded in a match
#In MLS a team is awarded 3 points for a win, 1 for a draw, and 0 for a loss

#Making a copy of the filtered data frame
home_df <- df_matches_filtered

#Creating variables for a new simpler data frame for our regression
home_df <- home_df |>
  rename(
    team = home,
    goals_for = home_score,
    goals_against = away_score
  )

home_df$is_home <- 1


#Filtering down just to the variables I will need for the analysis
columns_to_keep <- c('id', 'year', 'team', 'goals_for', 'goals_against', 'is_home')

home_df <- home_df[, columns_to_keep]


home_df

```
``` {r away}
#Now we are going to repeat the exact same steps for the away teams

#Making a copy of the filtered dataframe
away_df <- df_matches_filtered

#Creating variables for a new simpler dataframe for our regression
away_df <- away_df |>
  rename(
    team = away,
    goals_for = away_score,
    goals_against = home_score
  )

away_df$is_home <- 0

#Filtering down just to the variables I will need for the analysis
columns_to_keep <- c('id', 'year', 'team', 'goals_for', 'goals_against', 'is_home')

away_df <- away_df[, columns_to_keep]

away_df
```
```{r combining tables}
#Lets combine these dataframes so we can do our regression
team_matches <- bind_rows(home_df, away_df)

team_matches
```
```{r points}
#Since I am looking at the effect on points awarded we need to create a points column!

#Here is a simple line of code that will find the points for the home team!
team_matches <- team_matches |>
  mutate(points = case_when(
    goals_for > goals_against ~ 3,
    goals_for == goals_against ~ 1,
    TRUE ~ 0
  ))

team_matches
```
``` {r first regression}
#Now we can finally get to a regression!

formula <- 'points ~ is_home'
model <- lm(formula, data=team_matches)
summary(model)
confint(model)
```


## Interpreting the Regression Results Part 1:

These results suggest a clear home-field advantage in Major League Soccer!

Here are some of the key findings:


*  **Teams are predicted to earn about 0.9 more points per match when playing at home compared to playing away.** This is a meaningful difference, especially in a league where small point margins can have a big impact on standings.
*   The effect is statistically significant, with a **95% confidence interval ranging from approximately 0.84 to 0.99 points**, which gives confidence that the home advantage is real and not just driven by random variation in the data.
*   While the model is intentionally simple, **the R-squared value of 0.118 indicates that playing at home alone explains about 12% of the variation in points earned**. Given how many other factors influence match results (team quality, injuries, tactics, etc.), this suggests home venue plays a meaningful role in match outcomes.

Overall, this analysis shows that playing at home provides a real competitive advantage in MLS, increasing the number of points teams can expect to earn over the course of a season.

``` {r second regression}
#Maybe we can spruce this up even further though
#Those results were from 2015-2019, maybe we can see the home-field advantage each season
#Then, lastly, we can see each teams home field advantage in each season

model_season_interaction <- lm(
    formula='points ~ is_home * C(year)',
    data=team_matches
)

summary(model_season_interaction)
confint(model_season_interaction)
```


## Interpreting the Regression Results Part 2:

This model extends the earlier analysis by allowing the **home-field advantage to vary by season**.

* **Baseline effect (`is_home`)**  
  The `is_home` coefficient represents the **home-field advantage in the baseline season (2015)**.

* **Season interactions (`is_home × year`)**  
  The interaction terms measure **how the home-field advantage in each season differs from 2015**.

To estimate the home-field advantage for a given year, we add the baseline coefficient to that year’s interaction term.


### Estimated Home-Field Advantage by Season  
*(Points earned per match when playing at home)*

* **2015:** 0.89  
* **2016:** 0.95  
* **2017:** 1.04  
* **2018:** 0.88  
* **2019:** 0.82  


### Key Takeaways

* Teams earn **close to one additional point per match when playing at home** across all seasons, confirming a strong league-wide home-field advantage in MLS.
* None of the season-specific interaction terms are statistically significant, suggesting **limited evidence that the size of the home-field advantage changes meaningfully from year to year**.
* This result provides important context for the next analysis step, where **team-level home-field advantages** are estimated and greater variability is expected.

### Why This Matters

While match outcomes depend on many factors (team quality, injuries, tactics), this analysis shows that **venue alone plays a meaningful role in points earned**, and that effect is **remarkably consistent across seasons**.

```{r regression plot}
#Just a simple plot highlighting the regression results!
home_adv_df <- data.frame(
  year = c(2015, 2016, 2017, 2018, 2019),
  home_advantage = c(0.89, 0.95, 1.04, 0.88, 0.82)
)

# Plot
ggplot(home_adv_df, aes(x = year, y = home_advantage)) +
  geom_line(color = "steelblue", linewidth = 1) +
  geom_point(color = "steelblue", size = 2) +
  labs(
    title = "MLS Home-Field Advantage by Season",
    x = "Season",
    y = "Estimated Points Advantage at Home"
  ) +
  ylim(0, 1.2) +
  theme_minimal() +
  theme(
    panel.grid.minor = element_blank()
  )
```

```{r final regression}
#Alright now lets do it for each team. I think we are just going to do it overall, instead of over each season.
#I want to see if we can get some statistically significant results!

model_team_interaction <- lm(
    formula='points ~ is_home * C(team)',
    data=team_matches
)

summary(model_team_interaction)
confint(model_team_interaction)

```
```{r final regression plot}
library(tidyverse)

# Create the data
team_home_adv <- data.frame(
  team = c(
    "Atlanta United", "Chicago Fire FC", "Colorado Rapids", "Columbus Crew SC",
    "DC United", "FC Cincinnati", "FC Dallas", "Houston Dynamo", "LA Galaxy",
    "LAFC", "Minnesota United FC", "Montreal Impact", "New England Revolution",
    "New York City FC", "New York Red Bulls", "Orlando City SC",
    "Philadelphia Union", "Portland Timbers", "Real Salt Lake",
    "San Jose Earthquakes", "Seattle Sounders FC", "Sporting Kansas City",
    "Toronto FC", "Vancouver Whitecaps"
  ),
  home_effect = c(
    0.8295,
    0.8295 + 0.2803,
    0.8295 + 0.0440,
    0.8295 + 0.1579,
    0.8295 + 0.1176,
    0.8295 - 0.8295,
    0.8295 + 0.3165,
    0.8295 + 0.3567,
    0.8295 - 0.3661,
    0.8295 - 0.2532,
    0.8295 + 0.2926,
    0.8295 + 0.0693,
    0.8295 + 0.3287,
    0.8295 - 0.1000,
    0.8295 + 0.1525,
    0.8295 - 0.2295,
    0.8295 + 0.0399,
    0.8295 + 0.1056,
    0.8295 + 0.2813,
    0.8295 + 0.0962,
    0.8295 + 0.2203,
    0.8295 + 0.1344,
    0.8295 - 0.0231,
    0.8295 - 0.3874
  )
)

# Sort by estimated home-field advantage
team_home_adv <- team_home_adv |>
  arrange(home_effect)

# Plot
ggplot(team_home_adv, aes(x = home_effect, y = reorder(team, home_effect))) +
  geom_col(fill = "coral") +
  labs(
    title = "MLS Team-Level Home-Field Advantage (2015–2019)",
    x = "Estimated Home-Field Advantage (Points)",
    y = "Team"
  ) +
  theme_minimal() +
  theme(
    panel.grid.major.y = element_blank(),
    panel.grid.minor = element_blank()
  )

```

## Team-Level Home-Field Advantage in MLS

We extended our regression to estimate **home-field advantage for each team**, with **Atlanta United as the baseline**. The `is_home` coefficient represents the home advantage for Atlanta, and the interaction terms (`is_home:C(team)`) show how other teams differ from Atlanta.

To calculate each team’s estimated home-field advantage (in points per match), we **add the baseline `is_home` coefficient (0.83) to the team’s interaction coefficient**.

### Estimated Home-Field Advantage by Team

* **Atlanta United:** 0.83  
* **LAFC:** 0.83 + (-0.2532) ≈ 0.58  
* **Chicago Fire FC:** 0.83 + 0.2803 ≈ 1.11  
* **Colorado Rapids:** 0.83 + 0.044 ≈ 0.87  
* **Columbus Crew SC:** 0.83 + 0.1579 ≈ 0.99  
* **DC United:** 0.83 + 0.1176 ≈ 0.95  
* **FC Cincinnati:** 0.83 + (-0.8295) ≈ 0.00  
* **FC Dallas:** 0.83 + 0.3165 ≈ 1.15  
* **Houston Dynamo:** 0.83 + 0.3567 ≈ 1.19  
* **LA Galaxy:** 0.83 + (-0.0822) ≈ 0.75  
* **Minnesota United FC:** 0.83 + 0.2926 ≈ 1.12  
* **Montreal Impact:** 0.83 + 0.0693 ≈ 0.90  
* **New England Revolution:** 0.83 + 0.3287 ≈ 1.16  
* **New York City FC:** 0.83 + (-0.1000) ≈ 0.73  
* **New York Red Bulls:** 0.83 + 0.1525 ≈ 0.98  
* **Orlando City SC:** 0.83 + (-0.2295) ≈ 0.60  
* **Philadelphia Union:** 0.83 + 0.0399 ≈ 0.87  
* **Portland Timbers:** 0.83 + 0.1056 ≈ 0.94  
* **Real Salt Lake:** 0.83 + 0.2813 ≈ 1.11  
* **San Jose Earthquakes:** 0.83 + 0.0962 ≈ 0.93  
* **Seattle Sounders FC:** 0.83 + 0.2203 ≈ 1.05  
* **Sporting Kansas City:** 0.83 + 0.1344 ≈ 0.96  
* **Toronto FC:** 0.83 + (-0.0231) ≈ 0.81  
* **Vancouver Whitecaps:** 0.83 + (-0.3874) ≈ 0.44  


### Key Takeaways

* Home-field advantage varies **quite a bit across teams**, from virtually 0 points (FC Cincinnati) to over 1.15 points (FC Dallas, New England Revolution).  
* Atlanta United’s baseline advantage (0.83 points) is **close to the league average**.  
* These estimates give a clear, team-specific view of how playing at home impacts points earned over a season, which can inform **strategy, scheduling, and fan engagement analyses**.  
* Keep in mind that confidence intervals vary; some estimates may not be statistically significant on their own.

## **Conclusions**

The main takeaway is that there is a clear home-field advantage in MLS. While our last two regressions didn’t produce statistically significant results for every season or team, we consistently observed a general advantage for home teams across the five seasons analyzed. Even though the year- and team-level estimates are somewhat noisy, they still provide useful hints about real trends and shouldn’t be dismissed entirely.

#### **My Thoughts**

This project was designed to showcase my ability to use Python and basic statistical techniques to extract insights from large datasets, as well as to create meaningful visualizations. I consider this a solid baseline project, as it demonstrates core skills that my later projects build upon, incorporating more advanced methods and exploring more complex questions.

#### **P.S.**

I also replicated this analysis in R to highlight my proficiency in that language, showing that I can work seamlessly across multiple tools in analytics.















